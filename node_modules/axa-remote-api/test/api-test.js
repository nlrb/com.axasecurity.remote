'use strict';

const AxaRemote = require('axa-remote-api');

let settings = {
  ip: '192.168.1.17',
  port: 26
}

let remote = new AxaRemote(settings);
remote.connect()
	.then(async () => {
		console.log('Connection to', settings.ip + ':' + settings.port, 'has been opened');
    try {
      let result = await remote.checkAxaRemote();
      console.log('Is device Axa Remote 2.0?', result);
      try {
        result = await remote.sendCommand('?');
        console.log(result);
      } catch(e) {
        // Expected error
      }

      console.log(await remote.sendCommand('version'));

      console.log(await remote.sendCommand('DEVICE'));

      console.log(await remote.sendCommand('open'));

      setTimeout(async () => {
        let interval = setInterval(async () => {
          let result = await remote.sendCommand('status');
          console.log(result);
          if (result.code === 211) {
            remote.disconnect();
            clearInterval(interval);
          }
        }, 1000);
        let result = await remote.sendCommand('STOP');
        console.log(result);
      }, 10000);

      setTimeout(async () => {
        let result = await remote.sendCommand('close');
        console.log(result);
      }, 15000);

  	} catch(e) {
      console.error('Error:', e);
    }
  })
	.catch(err => console.error(err))
